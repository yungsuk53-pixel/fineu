<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINE U - AI Ï±óÎ¥á</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, push, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBYZ8Q9x6x6QJ9x6x6x6x6x6x6x6x6x6x6",
            authDomain: "fineu-demo.firebaseapp.com",
            databaseURL: "https://fineu-demo-default-rtdb.firebaseio.com",
            projectId: "fineu-demo",
            storageBucket: "fineu-demo.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:demo123456"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseUpdate = update;
        window.firebasePush = push;
        window.firebaseChild = child;

        console.log('üî• A4 Firebase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        /* Ìó§Îçî */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }

        .power-icon, .notification-icon {
            font-size: 20px;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .power-icon:hover, .notification-icon:hover {
            color: #667eea;
            transform: scale(1.1);
        }

        .fine-u-logo {
            display: flex;
            align-items: center;
        }

        .logo-image {
            height: 35px;
            width: auto;
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† */
        .main-content {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 160px;
            padding: 20px;
            overflow: hidden;
        }

        .page-title {
            text-align: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Ï±ÑÌåÖ ÏòÅÏó≠ */
        .chat-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            height: calc(100% - 60px);
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        /* Î©îÏãúÏßÄ Ïä§ÌÉÄÏùº */
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .ai-avatar {
            width: 32px;
            height: 32px;
            background-image: url('images/ÎòëÎ∂ÄÎ¶¨.png');
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message.user .message-bubble {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message.bot .message-bubble {
            background: #f1f3f4;
            color: #333;
            border-bottom-left-radius: 6px;
        }

        /* ÏûÖÎ†• ÏòÅÏó≠ */
        .input-area {
            position: fixed;
            bottom: 80px;
            left: 0;
            right: 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .input-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            border-radius: 25px;
            padding: 8px;
        }

        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 12px 16px;
            font-size: 14px;
            outline: none;
        }

        .chat-input::placeholder {
            color: #999;
        }

        .send-button {
            width: 40px;
            height: 40px;
            background: #667eea;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .send-button:hover {
            background: #5a6fd8;
            transform: scale(1.05);
        }

        /* ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 10px 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 10px;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-item.active {
            background: rgba(102, 126, 234, 0.2);
        }

        .nav-icon img {
            width: 24px;
            height: 24px;
        }

        .grade-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .grade-button:hover {
            transform: scale(1.1);
        }

        .grade-button img {
            width: 30px;
            height: 30px;
        }
    </style>
</head>
<body>
    <!-- Ìó§Îçî -->
    <div class="header">
        <i class="fas fa-power-off power-icon" onclick="logout()"></i>
        <div class="fine-u-logo">
            <img src="images/Î†àÏù¥Ïñ¥ 1.png" alt="FINE U Î°úÍ≥†" class="logo-image">
        </div>
        <i class="fas fa-bell notification-icon" onclick="showNotifications()"></i>
    </div>

    <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
    <div class="main-content">
        <div class="page-title">AI CHATBOT</div>
        
        <!-- Ï±ÑÌåÖ ÏòÅÏó≠ -->
        <div class="chat-area" id="chatArea">
            <!-- ÎèôÏ†ÅÏúºÎ°ú Ï±ÑÌåÖ Î©îÏãúÏßÄÍ∞Ä Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
        </div>
    </div>

    <!-- ÏûÖÎ†• ÏòÅÏó≠ -->
    <div class="input-area">
        <div class="input-container">
            <input type="text" class="chat-input" placeholder="Ï±ÑÌåÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî." id="chatInput" onkeypress="handleKeyPress(event)">
            <button class="send-button" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <div class="bottom-nav">
        <div class="nav-item" onclick="goToPage('a1.html')">
            <div class="nav-icon">
                <img src="images/Ïßë.png" alt="Ìôà">
            </div>
        </div>
        <div class="nav-item" onclick="goToPage('a2.html')">
            <div class="nav-icon">
                <img src="images/Î¨∏ÏÑú.png" alt="Î¨∏ÏÑú">
            </div>
        </div>
        <div class="grade-button" id="gradeButton" onclick="goToPage('a3.html')">
            <img id="gradeButtonImage" src="images/YELLOW „Öá.png" alt="YELLOW">
        </div>
        <div class="nav-item active" onclick="goToPage('a4.html')">
            <div class="nav-icon">
                <img src="images/Ï±ÑÌåÖ.png" alt="Ï±ÑÌåÖ">
            </div>
        </div>
        <div class="nav-item" onclick="goToPage('a5.html')">
            <div class="nav-icon">
                <img src="images/ÎçîÎ≥¥Í∏∞.png" alt="ÎçîÎ≥¥Í∏∞">
            </div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let chatHistory = [];
        let currentUser = null;

        // API ÏÑ§Ï†ï
        const GEMINI_API_KEY = 'AIzaSyBYZ8Q9x6x6QJ9x6x6x6x6x6x6x6x6x6x6'; // Îç∞Î™®Ïö©
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ü§ñ A4 AI Ï±óÎ¥á ÌéòÏù¥ÏßÄ Î°úÎìúÎê®');
            
            // Î°úÍ∑∏Ïù∏ ÌôïÏù∏
            if (!checkLogin()) {
                return;
            }
            
            // Ï¥àÍ∏∞ Î©îÏãúÏßÄ ÌëúÏãú
            setTimeout(() => {
                initializeChat();
            }, 500);
        });

        // Î°úÍ∑∏Ïù∏ ÌôïÏù∏
        function checkLogin() {
            const savedUser = localStorage.getItem('fineu_current_user');
            if (!savedUser) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                window.location.href = 'index.html';
                return false;
            }
            
            currentUser = JSON.parse(savedUser);
            console.log('‚úÖ A4 Î°úÍ∑∏Ïù∏ ÌôïÏù∏:', currentUser.id);
            return true;
        }

        // Ï¥àÍ∏∞ Ï±ÑÌåÖ Î©îÏãúÏßÄ
        function initializeChat() {
            const welcomeMessage = `ÏïàÎÖïÌïòÏÑ∏Ïöî! ÎòëÎ∂ÄÎ¶¨ÏûÖÎãàÎã§ üòä

Í∏àÏúµÏóê ÎåÄÌï¥ Í∂ÅÍ∏àÌïú Í≤ÉÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì†ÏßÄ Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî!

ÏòàÎ•º Îì§Ïñ¥:
‚Ä¢ Ï†ÄÏ∂ï Î∞©Î≤ï
‚Ä¢ ÏòàÏÇ∞ Í¥ÄÎ¶¨  
‚Ä¢ Ìà¨Ïûê Í∏∞Ï¥à ÏßÄÏãù
‚Ä¢ Ïã†Ïö©Ïπ¥Îìú ÏÇ¨Ïö©Î≤ï

Îì±Ïóê ÎåÄÌï¥ ÎèÑÏõÄÏùÑ ÎìúÎ¶¥ Ïàò ÏûàÏñ¥Ïöî!`;

            displayMessage(welcomeMessage, 'bot');
            chatHistory.push({ role: 'assistant', content: welcomeMessage });
        }

        // Î©îÏãúÏßÄ Ï†ÑÏÜ°
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // ÏÇ¨Ïö©Ïûê Î©îÏãúÏßÄ ÌëúÏãú
            displayMessage(message, 'user');
            chatHistory.push({ role: 'user', content: message });
            
            // ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî
            input.value = '';
            
            // Î°úÎî© Î©îÏãúÏßÄ ÌëúÏãú
            displayMessage('ÏÉùÍ∞Å Ï§ë...', 'bot');
            
            try {
                // AI ÏùëÎãµ ÏÉùÏÑ±
                const response = await generateResponse(message);
                
                // Î°úÎî© Î©îÏãúÏßÄ Ï†úÍ±∞
                removeLastMessage();
                
                // AI ÏùëÎãµ ÌëúÏãú
                displayMessage(response, 'bot');
                chatHistory.push({ role: 'assistant', content: response });
                
            } catch (error) {
                console.error('Ï±ÑÌåÖ Ïò§Î•ò:', error);
                removeLastMessage();
                displayMessage('Ï£ÑÏÜ°Ìï¥Ïöî. ÏùºÏãúÏ†ÅÏù∏ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', 'bot');
            }
        }

        // AI ÏùëÎãµ ÏÉùÏÑ±
        async function generateResponse(message) {
            // ÏúÑÌóòÌïú Ìà¨Ïûê Ï°∞Ïñ∏ Ï≤¥ÌÅ¨
            if (isDangerousInvestmentAdvice(message)) {
                return 'Ï£ÑÏÜ°Ìï¥Ïöî. Ï†ÄÎäî ÌäπÏ†ï Ìà¨Ïûê ÏÉÅÌíàÏóê ÎåÄÌïú Ï∂îÏ≤úÏùÄ ÎìúÎ¶¨ÏßÄ ÏïäÏïÑÏöî.\nÎåÄÏã† Í∏àÏúµ Í∏∞Ï¥à ÏßÄÏãùÏù¥ÎÇò Ìà¨Ïûê ÏõêÏπôÏóê ÎåÄÌï¥ ÏÑ§Î™ÖÌï¥ÎìúÎ¶¥ Ïàò ÏûàÏñ¥Ïöî!';
            }
            
            // Ïä§ÎßàÌä∏ ÏùëÎãµ ÏÉùÏÑ±
            return getSmartResponse(message);
        }

        // Ïä§ÎßàÌä∏ ÏùëÎãµ ÏãúÏä§ÌÖú
        function getSmartResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('ÏïàÎÖï') || lowerMessage.includes('hello')) {
                return 'ÏïàÎÖïÌïòÏÑ∏Ïöî! ÎòëÎ∂ÄÎ¶¨ÏûÖÎãàÎã§ üòä\nÍ∏àÏúµÏóê ÎåÄÌï¥ Í∂ÅÍ∏àÌïú Í≤ÉÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì†ÏßÄ Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî!';
            }
            
            if (lowerMessage.includes('Ìà¨Ïûê') && !isDangerousInvestmentAdvice(message)) {
                return 'Ìà¨ÏûêÏùò Í∏∞Î≥∏ ÏõêÏπôÏùÄ Î∂ÑÏÇ∞Ìà¨ÏûêÏôÄ Ïû•Í∏∞Ìà¨ÏûêÏòàÏöî.\nÏúÑÌóòÏùÑ Ï§ÑÏù¥Í∏∞ ÏúÑÌï¥ Ïó¨Îü¨ ÏûêÏÇ∞Ïóê ÎÇòÎàÑÏñ¥ Ìà¨ÏûêÌïòÍ≥†, ÏßßÏùÄ ÏãúÍ∞ÑÏóê ÌÅ∞ ÏàòÏùµÏùÑ Í∏∞ÎåÄÌïòÏßÄ ÏïäÎäî Í≤ÉÏù¥ Ï§ëÏöîÌï¥Ïöî! üìà';
            }
            
            if (lowerMessage.includes('Ï†ÄÏ∂ï') || lowerMessage.includes('Ï†ÅÍ∏à')) {
                return 'Ï†ÄÏ∂ïÏùÄ Î™©ÌëúÎ•º Ï†ïÌïòÍ≥† Íæ∏Ï§ÄÌûà ÌïòÎäî Í≤ÉÏù¥ Ï§ëÏöîÌï¥Ïöî!\nÎß§Ïõî ÏùºÏ†ï Í∏àÏï°ÏùÑ ÏûêÎèôÏúºÎ°ú Ï†ÄÏ∂ïÌïòÎäî ÏûêÎèôÏù¥Ï≤¥Î•º ÏÑ§Ï†ïÌïòÎ©¥ Îçî ÏâΩÍ≤å ÎèàÏùÑ Î™®ÏùÑ Ïàò ÏûàÏñ¥Ïöî üí∞';
            }
            
            if (lowerMessage.includes('ÏòàÏÇ∞') || lowerMessage.includes('Í∞ÄÍ≥ÑÎ∂Ä')) {
                return 'ÏòàÏÇ∞ Í¥ÄÎ¶¨Ïùò ÌïµÏã¨ÏùÄ ÏàòÏûÖÍ≥º ÏßÄÏ∂úÏùÑ Í∏∞Î°ùÌïòÎäî Í≤ÉÏù¥ÏóêÏöî.\n50/30/20 Î≤ïÏπôÏùÑ Ï∞∏Í≥†Ìï¥Î≥¥ÏÑ∏Ïöî: ÌïÑÏàòÏßÄÏ∂ú 50%, Ïó¨Í∞Ä 30%, Ï†ÄÏ∂ï 20% üìä';
            }
            
            if (lowerMessage.includes('Ïπ¥Îìú') || lowerMessage.includes('Ïã†Ïö©')) {
                return 'Ïã†Ïö©Ïπ¥ÎìúÎäî Ìé∏Î¶¨ÌïòÏßÄÎßå Ïã†Ï§ëÌïòÍ≤å ÏÇ¨Ïö©Ìï¥Ïïº Ìï¥Ïöî.\nÍ≤∞Ï†úÏùºÏóê ÎßûÏ∂∞ Ï†ÑÏï° ÎÇ©Î∂ÄÌïòÍ≥†, Í≥ºÎèÑÌïú ÏÇ¨Ïö©ÏùÄ ÌîºÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§ üí≥';
            }
            
            if (lowerMessage.includes('ÎåÄÏ∂ú') || lowerMessage.includes('Î∂ÄÏ±Ñ')) {
                return 'Î∂ÄÏ±Ñ Í¥ÄÎ¶¨Îäî ÎÜíÏùÄ Í∏àÎ¶¨Î∂ÄÌÑ∞ Î®ºÏ†Ä ÏÉÅÌôòÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏïÑÏöî.\nÎ¨¥Î¶¨Ìïú ÎåÄÏ∂úÎ≥¥Îã§Îäî ÌòÑÏã§Ï†ÅÏù∏ Í≥ÑÌöçÏùÑ ÏÑ∏Ïö∞Îäî Í≤ÉÏù¥ Ï§ëÏöîÌï©ÎãàÎã§ üìã';
            }
            
            return 'Í∏àÏúµÏóê ÎåÄÌï¥ Îçî Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú Î¨ºÏñ¥Î≥¥ÏãúÎ©¥ ÎèÑÏõÄÏùÑ ÎìúÎ¶¥ Ïàò ÏûàÏñ¥Ïöî!\nÏòàÎ•º Îì§Ïñ¥ Ï†ÄÏ∂ï, Ìà¨Ïûê, ÏòàÏÇ∞ Í¥ÄÎ¶¨ Îì±Ïóê ÎåÄÌï¥ Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì†ÏßÄ ÎßêÏîÄÌï¥Ï£ºÏÑ∏Ïöî ü§ù';
        }

        // ÏúÑÌóòÌïú Ìà¨Ïûê Ï°∞Ïñ∏ Í∞êÏßÄ
        function isDangerousInvestmentAdvice(message) {
            const dangerousKeywords = [
                'Ïñ¥Îñ§ Ï£ºÏãù', 'Ï£ºÏãù Ï∂îÏ≤ú', 'ÏÇ¨ÎäîÍ≤å Ï¢ãÏïÑ', 'Ìà¨Ïûê Ï∂îÏ≤ú', 'Ïñ¥Îñ§ Ï¢ÖÎ™©',
                'ÏΩîÏù∏ Ï∂îÏ≤ú', 'ÏïîÌò∏ÌôîÌèê Ï∂îÏ≤ú', 'ÌéÄÎìú Ï∂îÏ≤ú', 'ETF Ï∂îÏ≤ú',
                'ÏàòÏùµÎ•† ÎÜíÏùÄ', 'Îèà Î≤å', 'Ìà¨ÏûêÌïòÎ©¥ Ï¢ãÏùÄ', 'Ïò§Î•º Í≤É Í∞ôÏùÄ',
                'ÏÇ¨Ïïº Ìï†', 'ÌåîÏïÑÏïº Ìï†', 'ÏßÄÍ∏à ÏÇ¨Î©¥', 'Í∏âÎì±Ìï†', 'ÌïòÎùΩÌï†'
            ];
            
            return dangerousKeywords.some(keyword => message.includes(keyword));
        }

        // Î©îÏãúÏßÄ ÌëúÏãú
        function displayMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (sender === 'bot') {
                messageDiv.innerHTML = `
                    <div class="ai-avatar"></div>
                    <div class="message-bubble">${content.replace(/\n/g, '<br>')}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-bubble">${content}</div>
                `;
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // ÎßàÏßÄÎßâ Î©îÏãúÏßÄ Ï†úÍ±∞ (Î°úÎî© Î©îÏãúÏßÄ Ï†úÍ±∞Ïö©)
        function removeLastMessage() {
            const chatArea = document.getElementById('chatArea');
            if (chatArea.lastChild) {
                chatArea.removeChild(chatArea.lastChild);
            }
        }

        // ÌÇ§ ÏûÖÎ†• Ï≤òÎ¶¨
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // ÌéòÏù¥ÏßÄ Ïù¥Îèô
        function goToPage(page) {
            console.log('üîÑ ÌéòÏù¥ÏßÄ Ïù¥Îèô:', page);
            if (page !== 'a4.html') {
                window.location.href = page;
            }
        }

        // Î°úÍ∑∏ÏïÑÏõÉ
        function logout() {
            if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                localStorage.removeItem('fineu_current_user');
                window.location.href = 'index.html';
            }
        }

        // ÏïåÎ¶º (Ï§ÄÎπÑ Ï§ë)
        function showNotifications() {
            alert('ÏïåÎ¶º Í∏∞Îä•ÏùÄ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.');
        }
    </script>
</body>
</html>
