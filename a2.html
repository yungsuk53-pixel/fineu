<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FINE U - ÌïôÏäµ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, get, set, update } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyApKJHvNXftrzXAZsH41FxqVj0_Byh_V28",
            authDomain: "invest-97aa7.firebaseapp.com",
            databaseURL: "https://invest-97aa7-default-rtdb.firebaseio.com",
            projectId: "invest-97aa7",
            storageBucket: "invest-97aa7.firebasestorage.app",
            messagingSenderId: "136719207030",
            appId: "1:136719207030:web:391bd46b7b79800c0fed57",
            measurementId: "G-78K35WTPGQ"
        };
        
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseGet = get;
        window.firebaseSet = set;
        window.firebaseUpdate = update;
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .power-icon {
            width: 24px;
            height: 24px;
            color: #ff6b9d;
            font-size: 24px;
            cursor: pointer;
        }

        .fine-u-logo {
            display: flex;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
        }

        .logo-image {
            height: 40px;
            width: auto;
            object-fit: contain;
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            color: #ffd700;
            font-size: 20px;
            cursor: pointer;
        }

        .main-content {
            padding: 70px 20px 80px;
            max-width: 400px;
            margin: 0 auto;
        }

        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 30px;
        }

        .study-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .study-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .study-card:active {
            transform: translateY(0);
        }

        .study-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .star-icon {
            color: #ffd700;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .star-icon.completed {
            color: #4CAF50;
            animation: sparkle 0.6s ease-in-out;
        }

        .study-card.completed {
            background: linear-gradient(135deg, #f0f8f0, #e8f5e8);
            border: 2px solid #4CAF50;
        }

        .divider {
            height: 2px;
            background: #333;
            margin: 30px 0;
            border-radius: 1px;
        }

        .scrap-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scrap-content {
            text-align: center;
            color: #666;
            font-size: 16px;
            font-weight: 600;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: white;
            background-image: url('images/Î∞∞Í≤Ω.png');
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .bottom-nav::before {
            content: '';
            position: absolute;
            top: -32px;
            left: 50%;
            transform: translateX(-50%);
            width: 65px;
            height: 65px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            z-index: -1;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
        }

        .nav-item.active {
            color: #7cb9e8;
        }

        .nav-icon {
            font-size: 18px;
            margin-bottom: 4px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-icon img {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        .grade-button {
            width: 55px;
            height: 55px;
            background: #fafaf8;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            top: -35px;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .grade-button:hover {
            transform: scale(1.1);
        }

        .grade-button img {
            width: 45px;
            height: 45px;
            object-fit: contain;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #7cb9e8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 70px 15px 80px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <i class="fas fa-power-off power-icon" onclick="logout()"></i>
        <div class="fine-u-logo">
            <img src="images/Î†àÏù¥Ïñ¥ 1.png" alt="FINE U Î°úÍ≥†" class="logo-image">
        </div>
        <i class="fas fa-bell notification-icon" onclick="showNotifications()"></i>
    </div>

    <div class="main-content">
        <div class="page-title">STUDY ZONE</div>

        <div class="study-card fade-in" id="card-financial-terms" onclick="goToTermsPage()" style="animation-delay: 0.1s">
            <div class="study-title">Í∏àÏúµ Ïö©Ïñ¥</div>
            <i class="fas fa-star star-icon" id="star-financial-terms"></i>
        </div>

        <div class="study-card fade-in" id="card-financial-news" onclick="goToNewsPage()" style="animation-delay: 0.2s">
            <div class="study-title">Í∏àÏúµ Îâ¥Ïä§</div>
            <i class="fas fa-star star-icon" id="star-financial-news"></i>
        </div>

        <div class="study-card fade-in" id="card-financial-quiz" onclick="goToQuizPage()" style="animation-delay: 0.3s">
            <div class="study-title">Í∏àÏúµ ÌÄ¥Ï¶à</div>
            <i class="fas fa-star star-icon" id="star-financial-quiz"></i>
        </div>

        <div class="divider"></div>

        <div class="scrap-section fade-in" style="animation-delay: 0.4s">
            <div class="scrap-content">
                Ïä§ÌÅ¨Îû©
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item" onclick="goToPage('a1.html')">
            <div class="nav-icon">
                <img src="images/Ïßë.png" alt="Ìôà">
            </div>
        </div>
        <div class="nav-item active" onclick="goToPage('a2.html')">
            <div class="nav-icon">
                <img src="images/Î¨∏ÏÑú.png" alt="Î¨∏ÏÑú">
            </div>
        </div>
        <div class="grade-button" id="gradeButton" onclick="goToPage('a3.html')">
            <img id="gradeButtonImage" src="images/YELLOW „Öá.png" alt="YELLOW">
        </div>
        <div class="nav-item" onclick="goToPage('a4.html')">
            <div class="nav-icon">
                <img src="images/Ï±ÑÌåÖ.png" alt="Ï±ÑÌåÖ">
            </div>
        </div>
        <div class="nav-item" onclick="goToPage('a5.html')">
            <div class="nav-icon">
                <img src="images/ÎçîÎ≥¥Í∏∞.png" alt="ÎçîÎ≥¥Í∏∞">
            </div>
        </div>
    </div>

    <script>
        const GEMINI_API_KEY = 'AIzaSyBJhMtNOYyCfl6NRCQQz_CkTUHWP2TNweI';
        
        let currentUser = null;
        let userAssets = {};
        
        const levelSystem = {
            YELLOW: { name: 'YELLOW', exp: 0, max: 5000, navImage: 'YELLOW „Öá.png' },
            GREEN: { name: 'GREEN', exp: 5000, max: 15000, navImage: 'GREEN „Öá.png' },
            BLUE: { name: 'BLUE', exp: 15000, max: 30000, navImage: 'BLUE „Öá.png' },
            RED: { name: 'RED', exp: 30000, max: 50000, navImage: 'RED „Öá.png' },
            BLACK: { name: 'BLACK', exp: 50000, max: 999999, navImage: 'BLACK „Öá.png' }
        };

        function getTodayDate() {
            const now = new Date();
            const koreaTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
            const year = koreaTime.getFullYear();
            const month = String(koreaTime.getMonth() + 1).padStart(2, '0');
            const day = String(koreaTime.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        async function loadUserDataFromFirebase() {
            try {
                if (!window.firebaseDB) {
                    setTimeout(loadUserDataFromFirebase, 1000);
                    return;
                }

                const currentUser = JSON.parse(localStorage.getItem('fineu_current_user') || '{}');
                const userId = currentUser.id || currentUser.username || 'Test';
                
                const userRef = window.firebaseRef(window.firebaseDB, `users/${userId}`);
                const snapshot = await window.firebaseGet(userRef);

                if (snapshot.exists()) {
                    const firebaseData = snapshot.val();
                    userAssets = {
                        id: firebaseData.id || userId,
                        name: firebaseData.name || userId,
                        cash: firebaseData.cash || 0,
                        totalAssets: firebaseData.totalAssets || firebaseData.virtualBalance || firebaseData.cash || 0,
                        virtualBalance: firebaseData.virtualBalance || firebaseData.cash || 0,
                        level: firebaseData.level || 'yellow',
                        exp: firebaseData.exp || firebaseData.experience || 0,
                        experience: firebaseData.experience || firebaseData.exp || 0,
                        portfolio: firebaseData.portfolio || {},
                        joinDate: firebaseData.joinDate || new Date().toISOString().split('T')[0],
                        lastUpdated: firebaseData.lastUpdated || new Date().toISOString(),
                        studyProgress: firebaseData.studyProgress || {}
                    };
                    
                    updateGradeButton(userAssets.level);
                } else {
                    userAssets = {
                        id: userId,
                        name: userId,
                        cash: 10000000,
                        totalAssets: 10000000,
                        virtualBalance: 10000000,
                        level: 'yellow',
                        exp: 0,
                        experience: 0,
                        portfolio: {},
                        joinDate: new Date().toISOString().split('T')[0],
                        lastUpdated: new Date().toISOString(),
                        studyProgress: {}
                    };
                    updateGradeButton('yellow');
                }
                
                localStorage.setItem('fineu_user_assets', JSON.stringify(userAssets));
                checkTodayCompletion();
                await generateTodayContent();

            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïò§Î•ò:', error);
                userAssets = {
                    id: 'Test',
                    name: 'Test',
                    cash: 10000000,
                    level: 'yellow',
                    exp: 0,
                    experience: 0,
                    studyProgress: {}
                };
                updateGradeButton('yellow');
            }
        }

        function checkTodayCompletion() {
            const today = getTodayDate();
            
            if (!userAssets.studyProgress) {
                userAssets.studyProgress = {};
            }
            
            const todayProgress = userAssets.studyProgress[today] || {};
            
            updateCardCompletion('financial-terms', todayProgress.financialTerms === true);
            updateCardCompletion('financial-news', todayProgress.financialNews === true);
            updateCardCompletion('financial-quiz', todayProgress.financialQuiz === true);
        }

        function updateCardCompletion(type, completed) {
            const card = document.getElementById(`card-${type}`);
            const star = document.getElementById(`star-${type}`);
            
            if (completed) {
                card.classList.add('completed');
                star.classList.add('completed');
            } else {
                card.classList.remove('completed');
                star.classList.remove('completed');
            }
        }

        function updateGradeButton(grade) {
            const upperGrade = grade.toUpperCase();
            const levelData = levelSystem[upperGrade];
            
            if (levelData) {
                const gradeButtonImage = document.getElementById('gradeButtonImage');
                if (gradeButtonImage && levelData.navImage) {
                    gradeButtonImage.src = `images/${levelData.navImage}`;
                    gradeButtonImage.alt = levelData.name;
                }
            }
        }

        async function getLatestFinanceNews() {
            try {
                const koreaTime = new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
                const dateStr = `${koreaTime.getFullYear()}ÎÖÑ ${koreaTime.getMonth() + 1}Ïõî ${koreaTime.getDate()}Ïùº`;
                
                const rssProxies = [
                    'https://api.allorigins.win/get?url=',
                    'https://corsproxy.io/?',
                    'https://api.codetabs.com/v1/proxy?quest='
                ];
                
                const rssUrls = [
                    'https://news.google.com/rss/search?q=Í∏àÏúµ+OR+Í≤ΩÏ†ú+OR+Ï£ºÏãù+OR+ÏΩîÏä§Ìîº&hl=ko&gl=KR&ceid=KR:ko',
                    'https://news.google.com/rss/search?q=ÌïúÍµ≠ÏùÄÌñâ+OR+Í∏àÎ¶¨+OR+ÌôòÏú®&hl=ko&gl=KR&ceid=KR:ko',
                    'https://news.google.com/rss/search?q=ÏÇºÏÑ±Ï†ÑÏûê+OR+SKÌïòÏù¥ÎãâÏä§+OR+Î∞òÎèÑÏ≤¥&hl=ko&gl=KR&ceid=KR:ko'
                ];
                
                let allNews = [];
                
                for (const rssUrl of rssUrls) {
                    for (const proxy of rssProxies) {
                        try {
                            const proxyUrl = proxy + encodeURIComponent(rssUrl);
                            const response = await fetch(proxyUrl);
                            
                            if (response.ok) {
                                const data = await response.text();
                                const newsItems = parseRSSData(data);
                                
                                if (newsItems && newsItems.length > 0) {
                                    allNews.push(...newsItems);
                                    break;
                                }
                            }
                        } catch (error) {
                            console.warn(`RSS ÌîÑÎ°ùÏãú Ïã§Ìå®:`, error);
                        }
                    }
                }
                
                if (allNews.length > 0) {
                    const uniqueNews = allNews
                        .filter((item, index, self) => 
                            index === self.findIndex(t => t.title === item.title)
                        )
                        .slice(0, 5)
                        .map((item, index) => ({
                            id: `news-${index}`,
                            title: item.title.replace(/<[^>]*>/g, ''),
                            description: item.description.replace(/<[^>]*>/g, '').substring(0, 200) + '...',
                            content: item.description.replace(/<[^>]*>/g, ''),
                            url: item.url,
                            source: item.source || 'Google News',
                            category: 'Í∏àÏúµÎâ¥Ïä§',
                            publishedAt: item.publishedAt || koreaTime.toISOString()
                        }));
                
                    return uniqueNews;
                }
                
                return getFallbackNews();
                
            } catch (error) {
                console.error('Îâ¥Ïä§ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
                return getFallbackNews();
            }
        }

        function parseRSSData(xmlText) {
            try {
                if (xmlText.includes('"contents"')) {
                    const jsonData = JSON.parse(xmlText);
                    xmlText = jsonData.contents;
                }
                
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                const items = xmlDoc.querySelectorAll('item');
                
                const newsItems = [];
                items.forEach((item, index) => {
                    if (index < 5) {
                        const title = item.querySelector('title')?.textContent;
                        const description = item.querySelector('description')?.textContent || '';
                        const link = item.querySelector('link')?.textContent;
                        const pubDate = item.querySelector('pubDate')?.textContent;
                        const source = item.querySelector('source')?.textContent || 'Google News';
                        
                        if (title && link) {
                            const financeKeywords = ['Í∏àÏúµ', 'Í≤ΩÏ†ú', 'ÏΩîÏä§Ìîº', 'ÏΩîÏä§Îã•', 'ÌïúÍµ≠ÏùÄÌñâ', 'Í∏àÎ¶¨', 'ÌôòÏú®', 'ÏÇºÏÑ±Ï†ÑÏûê', 'Ï£ºÏãù', 'Ìà¨Ïûê', 'Ï¶ùÏãú', 'Í∏∞ÏóÖ', 'ÏãúÏû•', 'ÏùÄÌñâ', 'Î≥¥Ìóò', 'Ï¶ùÍ∂å'];
                            const hasKeyword = financeKeywords.some(keyword => 
                                title.includes(keyword) || description.includes(keyword)
                            );
                            
                            if (hasKeyword) {
                                newsItems.push({
                                    title: title,
                                    description: description || title,
                                    url: link,
                                    source: source,
                                    publishedAt: pubDate || new Date().toISOString()
                                });
                            }
                        }
                    }
                });
                
                return newsItems;
            } catch (error) {
                console.error('RSS ÌååÏã± Ïò§Î•ò:', error);
                return [];
            }
        }

        function getFallbackNews() {
            const today = new Date();
            const kospiPrice = 2650 + Math.floor(Math.random() * 100);
            const usdRate = 1320 + Math.floor(Math.random() * 50);
            
            return [
                {
                    id: 'news-0',
                    title: `ÌïúÍµ≠ÏùÄÌñâ, Í∏∞Ï§ÄÍ∏àÎ¶¨ 3.50% ÎèôÍ≤∞ Í≤∞Ï†ï`,
                    description: `ÌïúÍµ≠ÏùÄÌñâÏù¥ ${today.getMonth() + 1}Ïõî Í∏àÏúµÌÜµÌôîÏúÑÏõêÌöåÏóêÏÑú ÌòÑÌñâ Í∏∞Ï§ÄÍ∏àÎ¶¨ 3.50%Î•º Ïú†ÏßÄÌïòÍ∏∞Î°ú Í≤∞Ï†ïÌñàÏäµÎãàÎã§.`,
                    content: `ÌïúÍµ≠ÏùÄÌñâÏù¥ ${today.getMonth() + 1}Ïõî Í∏àÏúµÌÜµÌôîÏúÑÏõêÌöåÏóêÏÑú ÌòÑÌñâ Í∏∞Ï§ÄÍ∏àÎ¶¨ 3.50%Î•º Ïú†ÏßÄÌïòÍ∏∞Î°ú Í≤∞Ï†ïÌñàÏäµÎãàÎã§. Ïù∏ÌîåÎ†àÏù¥ÏÖò ÏïïÎ†•Í≥º Í≤ΩÏ†úÏÑ±Ïû•ÏÑ∏Î•º Ï¢ÖÌï© Í≥†Î†§Ìïú Í≤∞Í≥ºÎ°ú Î∂ÑÏÑùÎê©ÎãàÎã§.`,
                    url: "https://www.bok.or.kr/",
                    source: "ÌïúÍµ≠ÏùÄÌñâ",
                    category: "ÌÜµÌôîÏ†ïÏ±Ö",
                    publishedAt: today.toISOString()
                },
                {
                    id: 'news-1',
                    title: `ÏΩîÏä§Ìîº ${kospiPrice}ÏÑ†ÏóêÏÑú Îì±ÎùΩ - Ïô∏Íµ≠Ïù∏ Ìà¨Ïûê ÎèôÌñ• Ï£ºÎ™©`,
                    description: `Íµ≠ÎÇ¥ Ï¶ùÏãúÍ∞Ä ${kospiPrice}ÎåÄÏóêÏÑú Îì±ÎùΩÏùÑ Í±∞Îì≠ÌïòÍ≥† ÏûàÏäµÎãàÎã§.`,
                    content: `Íµ≠ÎÇ¥ Ï¶ùÏãúÍ∞Ä ${kospiPrice}ÎåÄÏóêÏÑú Îì±ÎùΩÏùÑ Í±∞Îì≠ÌïòÍ≥† ÏûàÏäµÎãàÎã§. Î∞òÎèÑÏ≤¥ÏôÄ 2Ï∞®Ï†ÑÏßÄ ÏóÖÏ¢ÖÏùÑ Ï§ëÏã¨ÏúºÎ°ú Ïô∏Íµ≠Ïù∏ Ìà¨ÏûêÏûêÎì§Ïùò Îß§Îß§ Ìå®ÌÑ¥Ïù¥ ÏãúÏû• Î∞©Ìñ•ÏÑ±ÏùÑ Ï¢åÏö∞ÌïòÍ≥† ÏûàÏäµÎãàÎã§.`,
                    url: "https://finance.naver.com/sise/",
                    source: "ÌïúÍµ≠Í±∞ÎûòÏÜå",
                    category: "Ï¶ùÏãúÎèôÌñ•",
                    publishedAt: today.toISOString()
                },
                {
                    id: 'news-2',
                    title: `Îã¨Îü¨-Ïõê ÌôòÏú® ${usdRate}ÏõêÎåÄ - ÎØ∏ Ïó∞Ï§Ä Ï†ïÏ±Ö ÏòÅÌñ•`,
                    description: `Ïõê-Îã¨Îü¨ ÌôòÏú®Ïù¥ ${usdRate}ÏõêÎåÄÏóêÏÑú ÌòïÏÑ±ÎêòÍ≥† ÏûàÏäµÎãàÎã§.`,
                    content: `Ïõê-Îã¨Îü¨ ÌôòÏú®Ïù¥ ${usdRate}ÏõêÎåÄÏóêÏÑú ÌòïÏÑ±ÎêòÍ≥† ÏûàÏäµÎãàÎã§. ÎØ∏Íµ≠ Ïó∞Î∞©Ï§ÄÎπÑÏ†úÎèÑÏùò ÌÜµÌôîÏ†ïÏ±Ö Î∞©Ìñ•Í≥º Íµ≠ÎÇ¥ Í≤ΩÏ†úÏßÄÌëúÍ∞Ä ÌôòÏú® Î≥ÄÎèôÏùò Ï£ºÏöî ÏöîÏù∏ÏúºÎ°ú ÏûëÏö©ÌïòÍ≥† ÏûàÏäµÎãàÎã§.`,
                    url: "https://www.koreaexim.go.kr/",
                    source: "ÌïúÍµ≠ÏàòÏ∂úÏûÖÏùÄÌñâ",
                    category: "ÌôòÏú®ÎèôÌñ•",
                    publishedAt: today.toISOString()
                },
                {
                    id: 'news-3',
                    title: `ÏÇºÏÑ±Ï†ÑÏûê Ïã§Ï†Å Ï†ÑÎßù - Î©îÎ™®Î¶¨ Î∞òÎèÑÏ≤¥ ÏàòÏöî ÌöåÎ≥µ`,
                    description: `ÏÇºÏÑ±Ï†ÑÏûêÏùò ${today.getMonth() + 1}Ïõî Ïã§Ï†ÅÏóê ÎåÄÌïú ÏãúÏû• Í¥ÄÏã¨Ïù¥ ÎÜíÏïÑÏßÄÍ≥† ÏûàÏäµÎãàÎã§.`,
                    content: `ÏÇºÏÑ±Ï†ÑÏûêÏùò ${today.getMonth() + 1}Ïõî Ïã§Ï†ÅÏóê ÎåÄÌïú ÏãúÏû• Í¥ÄÏã¨Ïù¥ ÎÜíÏïÑÏßÄÍ≥† ÏûàÏäµÎãàÎã§. Î©îÎ™®Î¶¨ Î∞òÎèÑÏ≤¥ ÏóÖÌô© Í∞úÏÑ†Í≥º Ïä§ÎßàÌä∏Ìè∞ ÏÇ¨ÏóÖ Î∂ÄÎ¨∏Ïùò ÏïàÏ†ïÏ†Å ÏÑ±Ïû•Ïù¥ Ï£ºÏöî Ìè¨Ïù∏Ìä∏Î°ú Î∂ÑÏÑùÎê©ÎãàÎã§.`,
                    url: "https://news.samsung.com/kr/",
                    source: "ÏÇºÏÑ±Ï†ÑÏûê",
                    category: "Í∏∞ÏóÖÏã§Ï†Å",
                    publishedAt: today.toISOString()
                },
                {
                    id: 'news-4',
                    title: `Ï≤≠ÎÖÑÏ∏µ Ìà¨Ïûê Ìä∏Î†åÎìú Î≥ÄÌôî - ÏïàÏ†ïÏÑ± Ï§ëÏãú`,
                    description: `ÏµúÍ∑º Ï≤≠ÎÖÑÏ∏µ Ìà¨ÏûêÏûêÎì§ ÏÇ¨Ïù¥ÏóêÏÑú Í≥†ÏúÑÌóò ÏûêÏÇ∞Î≥¥Îã§ ÏïàÏ†ïÏ†ÅÏù∏ Î∞∞ÎãπÏ£ºÏôÄ Ï±ÑÍ∂åÏóê ÎåÄÌïú Í¥ÄÏã¨Ïù¥ ÎÜíÏïÑÏßÄÍ≥† ÏûàÏäµÎãàÎã§.`,
                    content: `ÏµúÍ∑º Ï≤≠ÎÖÑÏ∏µ Ìà¨ÏûêÏûêÎì§ ÏÇ¨Ïù¥ÏóêÏÑú Í≥†ÏúÑÌóò ÏûêÏÇ∞Î≥¥Îã§ ÏïàÏ†ïÏ†ÅÏù∏ Î∞∞ÎãπÏ£ºÏôÄ Ï±ÑÍ∂åÏóê ÎåÄÌïú Í¥ÄÏã¨Ïù¥ ÎÜíÏïÑÏßÄÍ≥† ÏûàÏäµÎãàÎã§. Í∏àÏúµÎãπÍµ≠ÏùÄ Í±¥Ï†ÑÌïú Ìà¨ÏûêÎ¨∏Ìôî Ï†ïÏ∞©ÏùÑ ÏúÑÌïú ÍµêÏú°ÏùÑ ÌôïÎåÄÌïòÍ≥† ÏûàÏäµÎãàÎã§.`,
                    url: "https://www.fss.or.kr/",
                    source: "Í∏àÏúµÍ∞êÎèÖÏõê",
                    category: "Ìà¨ÏûêÎèôÌñ•",
                    publishedAt: today.toISOString()
                }
            ];
        }

        async function callGeminiAPI(prompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`GEMINI API Ïò§Î•ò: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    let result = data.candidates[0].content.parts[0].text;
                    
                    result = result.replace(/```(?:json|javascript|js|html|css)?\s*/gi, '');
                    result = result.replace(/```\s*/g, '');
                    result = result.replace(/`/g, '');
                    result = result.trim();
                    
                    return result;
                } else {
                    throw new Error('GEMINI API ÏùëÎãµ ÌòïÏãù Ïò§Î•ò');
                }
                
            } catch (error) {
                console.error('GEMINI API Ìò∏Ï∂ú Ïã§Ìå®:', error);
                return null;
            }
        }

        async function generateTodayContent() {
            const today = getTodayDate();
            const cacheKey = `todayFinancialData_${today}`;
            
            const cached = localStorage.getItem(cacheKey);
            if (cached) {
                const data = JSON.parse(cached);
                if (data.date === today) {
                    localStorage.setItem('todayFinancialData', cached);
                    return;
                }
            }
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading-spinner';
            loadingDiv.style.position = 'fixed';
            loadingDiv.style.top = '50%';
            loadingDiv.style.left = '50%';
            loadingDiv.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(loadingDiv);
            
            try {
                const newsData = await getLatestFinanceNews();
                
                const termsPrompt = `Ïò§ÎäòÏùò Í∏àÏúµ Îâ¥Ïä§Î•º Î∞îÌÉïÏúºÎ°ú Ï§ëÏöîÌïú Í∏àÏúµ Ïö©Ïñ¥ 3Í∞úÎ•º ÏÑ†Ï†ïÌïòÍ≥† JSON ÌòïÏãùÏúºÎ°ú Î∞òÌôòÌï¥Ï£ºÏÑ∏Ïöî:
                ${newsData.map(n => n.title).join('\n')}
                
                Îã§Ïùå ÌòïÏãùÏúºÎ°ú Î∞òÌôò:
                [
                    {
                        "id": "term-0",
                        "term": "Ïö©Ïñ¥Î™Ö (ÏòÅÎ¨∏Î™Ö)",
                        "definition": "Ï†ïÏùò",
                        "example": "Ïã§Ï†ú ÏÇ¨Î°Ä",
                        "isToday": true
                    }
                ]`;
                
                const quizPrompt = `Îã§Ïùå Í∏àÏúµ Îâ¥Ïä§Î•º Î∞îÌÉïÏúºÎ°ú Ï¥àÍ∏â ÌÄ¥Ï¶à 5Î¨∏Ï†úÎ•º JSON ÌòïÏãùÏúºÎ°ú ÎßåÎì§Ïñ¥Ï£ºÏÑ∏Ïöî:
                ${newsData.map(n => n.title).join('\n')}
                
                Îã§Ïùå ÌòïÏãùÏúºÎ°ú Î∞òÌôò:
                {
                    "beginner": [
                        {
                            "question": "Î¨∏Ï†ú",
                            "options": ["ÏÑ†ÌÉùÏßÄ1", "ÏÑ†ÌÉùÏßÄ2", "ÏÑ†ÌÉùÏßÄ3", "ÏÑ†ÌÉùÏßÄ4"],
                            "correct": 0,
                            "explanation": "ÏÑ§Î™Ö"
                        }
                    ]
                }`;
                
                let terms = [];
                let quizzes = { beginner: [] };
                
                const termsResponse = await callGeminiAPI(termsPrompt);
                if (termsResponse) {
                    try {
                        const jsonMatch = termsResponse.match(/\[[\s\S]*\]/);
                        if (jsonMatch) {
                            terms = JSON.parse(jsonMatch[0]);
                        }
                    } catch (e) {
                        console.error('Terms ÌååÏã± Ïã§Ìå®:', e);
                    }
                }
                
                if (terms.length === 0) {
                    terms = [
                        {
                            id: "term-0",
                            term: "Î≥µÎ¶¨ (Compound Interest)",
                            definition: "ÏõêÍ∏àÏóê Î∂ôÏùÄ Ïù¥ÏûêÍ∞Ä Îã§Ïãú ÏõêÍ∏àÏù¥ ÎêòÏñ¥ Ïù¥ÏûêÍ∞Ä Î∂ôÎäî Î∞©Ïãù",
                            example: "100ÎßåÏõêÏùÑ Ïó∞ 10% Î≥µÎ¶¨Î°ú Ìà¨ÏûêÌïòÎ©¥ 1ÎÖÑ ÌõÑ 110ÎßåÏõê, 2ÎÖÑ ÌõÑ 121ÎßåÏõê",
                            isToday: true
                        },
                        {
                            id: "term-1",
                            term: "Î∂ÑÏÇ∞Ìà¨Ïûê (Diversification)",
                            definition: "Ïó¨Îü¨ Ï¢ÖÎ™©Ïù¥ÎÇò ÏûêÏÇ∞Ïóê Ìà¨ÏûêÌïòÏó¨ ÏúÑÌóòÏùÑ Ï§ÑÏù¥Îäî Ï†ÑÎûµ",
                            example: "Ï£ºÏãù 50%, Ï±ÑÍ∂å 30%, ÌòÑÍ∏à 20%Î°ú Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Íµ¨ÏÑ±",
                            isToday: false
                        },
                        {
                            id: "term-2",
                            term: "PER (Price Earnings Ratio)",
                            definition: "Ï£ºÍ∞ÄÏàòÏùµÎπÑÏú®Î°ú Ï£ºÍ∞ÄÎ•º Ï£ºÎãπÏàúÏù¥ÏùµÏúºÎ°ú ÎÇòÎàà Í∞í",
                            example: "PERÏù¥ 10Ïù¥Î©¥ Ìà¨ÏûêÍ∏à ÌöåÏàòÏóê 10ÎÖÑÏù¥ Í±∏Î¶∞Îã§Îäî ÏùòÎØ∏",
                            isToday: false
                        }
                    ];
                }
                
                const quizResponse = await callGeminiAPI(quizPrompt);
                if (quizResponse) {
                    try {
                        const jsonMatch = quizResponse.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            const parsed = JSON.parse(jsonMatch[0]);
                            if (parsed.beginner && Array.isArray(parsed.beginner)) {
                                quizzes = parsed;
                            }
                        }
                    } catch (e) {
                        console.error('Quiz ÌååÏã± Ïã§Ìå®:', e);
                    }
                }
                
                if (quizzes.beginner.length === 0) {
                    quizzes = {
                        beginner: [
                            {
                                question: "Î≥µÎ¶¨Ïùò Í∞ÄÏû• ÌÅ∞ Ïû•Ï†êÏùÄ?",
                                options: ["ÏõêÍ∏à Î≥¥Ïû•", "Ïù¥ÏûêÍ∞Ä Ïù¥ÏûêÎ•º ÎÇ≥Îäî Ìö®Í≥º", "ÏÑ∏Í∏à Î©¥Ï†ú", "ÌôòÏú® Ï∞®Ïùµ"],
                                correct: 1,
                                explanation: "Î≥µÎ¶¨Îäî Ïù¥ÏûêÍ∞Ä ÏõêÍ∏àÏóê ÎçîÌï¥Ï†∏ Îã§Ïãú Ïù¥ÏûêÎ•º Î∞úÏÉùÏãúÌÇ§Îäî Ìö®Í≥ºÍ∞Ä ÏûàÏäµÎãàÎã§."
                            },
                            {
                                question: "Î∂ÑÏÇ∞Ìà¨ÏûêÏùò Î™©Ï†ÅÏùÄ?",
                                options: ["ÏàòÏùµ Í∑πÎåÄÌôî", "ÏúÑÌóò Î∂ÑÏÇ∞", "ÏÑ∏Í∏à Ï†àÏïΩ", "Í±∞Îûò ÎπÑÏö© Ï†àÍ∞ê"],
                                correct: 1,
                                explanation: "Î∂ÑÏÇ∞Ìà¨ÏûêÎäî Ïó¨Îü¨ ÏûêÏÇ∞Ïóê Ìà¨ÏûêÌïòÏó¨ Ï†ÑÏ≤¥ ÏúÑÌóòÏùÑ Ï§ÑÏù¥Îäî Í≤ÉÏù¥ Î™©Ï†ÅÏûÖÎãàÎã§."
                            },
                            {
                                question: "Ï£ºÏãù Ìà¨Ïûê Ïãú Í∞ÄÏû• Ï§ëÏöîÌïú Í≤ÉÏùÄ?",
                                options: ["Îã®Í∏∞ Ï∞®Ïùµ", "Í∏∞ÏóÖ Î∂ÑÏÑù", "ÏãúÏû• ÏÜåÎ¨∏", "ÏπúÍµ¨ Ï∂îÏ≤ú"],
                                correct: 1,
                                explanation: "Ï£ºÏãù Ìà¨ÏûêÎäî Í∏∞ÏóÖÏùò Ïû¨Î¨¥ÏÉÅÌÉúÏôÄ ÏÑ±Ïû•ÏÑ±ÏùÑ Î∂ÑÏÑùÌïòÎäî Í≤ÉÏù¥ Í∞ÄÏû• Ï§ëÏöîÌï©ÎãàÎã§."
                            },
                            {
                                question: "ÏòàÍ∏àÏûêÎ≥¥Ìò∏Ï†úÎèÑÏùò Î≥¥Ìò∏ ÌïúÎèÑÎäî?",
                                options: ["1Ï≤úÎßåÏõê", "3Ï≤úÎßåÏõê", "5Ï≤úÎßåÏõê", "1ÏñµÏõê"],
                                correct: 2,
                                explanation: "ÏòàÍ∏àÏûêÎ≥¥Ìò∏Ï†úÎèÑÎäî Í∏àÏúµÍ∏∞Í¥ÄÎãπ 5Ï≤úÎßåÏõêÍπåÏßÄ Î≥¥Ìò∏Ìï©ÎãàÎã§."
                            },
                            {
                                question: "Ïù∏ÌîåÎ†àÏù¥ÏÖòÏù¥ Î∞úÏÉùÌïòÎ©¥?",
                                options: ["ÌôîÌèêÍ∞ÄÏπò ÏÉÅÏäπ", "ÌôîÌèêÍ∞ÄÏπò ÌïòÎùΩ", "Í∏àÎ¶¨ ÌïòÎùΩ", "ÌôòÏú® ÏïàÏ†ï"],
                                correct: 1,
                                explanation: "Ïù∏ÌîåÎ†àÏù¥ÏÖòÏùÄ Î¨ºÍ∞Ä ÏÉÅÏäπÏúºÎ°ú ÌôîÌèêÏùò Íµ¨Îß§Î†•Ïù¥ ÌïòÎùΩÌïòÎäî ÌòÑÏÉÅÏûÖÎãàÎã§."
                            }
                        ],
                        intermediate: [],
                        advanced: []
                    };
                }
                
                const todayData = {
                    date: today,
                    news: newsData,
                    terms: terms,
                    quizzes: quizzes
                };
                
                localStorage.setItem(cacheKey, JSON.stringify(todayData));
                localStorage.setItem('todayFinancialData', JSON.stringify(todayData));
                
            } catch (error) {
                console.error('ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ïã§Ìå®:', error);
                
                const fallbackData = {
                    date: today,
                    news: getFallbackNews(),
                    terms: [
                        {
                            id: "term-0",
                            term: "Î≥µÎ¶¨ (Compound Interest)",
                            definition: "ÏõêÍ∏àÏóê Î∂ôÏùÄ Ïù¥ÏûêÍ∞Ä Îã§Ïãú ÏõêÍ∏àÏù¥ ÎêòÏñ¥ Ïù¥ÏûêÍ∞Ä Î∂ôÎäî Î∞©Ïãù",
                            example: "100ÎßåÏõêÏùÑ Ïó∞ 10% Î≥µÎ¶¨Î°ú Ìà¨ÏûêÌïòÎ©¥ 1ÎÖÑ ÌõÑ 110ÎßåÏõê, 2ÎÖÑ ÌõÑ 121ÎßåÏõê",
                            isToday: true
                        }
                    ],
                    quizzes: {
                        beginner: [
                            {
                                question: "Î≥µÎ¶¨Ïùò Í∞ÄÏû• ÌÅ∞ Ïû•Ï†êÏùÄ?",
                                options: ["ÏõêÍ∏à Î≥¥Ïû•", "Ïù¥ÏûêÍ∞Ä Ïù¥ÏûêÎ•º ÎÇ≥Îäî Ìö®Í≥º", "ÏÑ∏Í∏à Î©¥Ï†ú", "ÌôòÏú® Ï∞®Ïùµ"],
                                correct: 1,
                                explanation: "Î≥µÎ¶¨Îäî Ïù¥ÏûêÍ∞Ä ÏõêÍ∏àÏóê ÎçîÌï¥Ï†∏ Îã§Ïãú Ïù¥ÏûêÎ•º Î∞úÏÉùÏãúÌÇ§Îäî Ìö®Í≥ºÍ∞Ä ÏûàÏäµÎãàÎã§."
                            }
                        ]
                    }
                };
                
                localStorage.setItem(cacheKey, JSON.stringify(fallbackData));
                localStorage.setItem('todayFinancialData', JSON.stringify(fallbackData));
            } finally {
                if (loadingDiv.parentNode) {
                    document.body.removeChild(loadingDiv);
                }
            }
        }

        function goToTermsPage() {
            window.location.href = 'financial-terms.html';
        }

        function goToNewsPage() {
            window.location.href = 'financial-news.html';
        }

        function goToQuizPage() {
            window.location.href = 'financial-quiz.html';
        }

        function goToPage(page) {
            if (page === 'a2.html') return;
            window.location.href = page;
        }

        function logout() {
            if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                localStorage.removeItem('fineu_current_user');
                localStorage.removeItem('fineu_user_assets');
                window.location.href = 'index.html';
            }
        }

        function showNotifications() {
            alert('üìö ÏÉàÎ°úÏö¥ ÌïôÏäµ ÏΩòÌÖêÏ∏†Í∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§!\n\n‚Ä¢ Ïò§ÎäòÏùò Í∏àÏúµ Ïö©Ïñ¥\n‚Ä¢ ÏµúÏã† Í∏àÏúµ Îâ¥Ïä§ Î∂ÑÏÑù\n‚Ä¢ Í∏àÏúµ ÌÄ¥Ï¶à Ï±åÎ¶∞ÏßÄ\n\nÏßÄÍ∏à Î∞îÎ°ú ÌïôÏäµÌïòÍ≥† Î≥¥ÏÉÅÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî!');
        }

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('fineu_current_user');
            if (!savedUser) {
                window.location.href = 'index.html';
                return false;
            }
            
            currentUser = JSON.parse(savedUser);
            return true;
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (!checkLoginStatus()) return;
            
            setTimeout(() => {
                loadUserDataFromFirebase();
            }, 1000);
            
            const cards = document.querySelectorAll('.fade-in');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>
