<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FINE U - 금융 학습</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            zoom: 1;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        
        .level-badge-nav {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10;
        }
        
        .level-yellow { background: linear-gradient(135deg, #FCD34D, #F59E0B); }

        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 12px 0 8px 0;
            z-index: 50;
        }

        .nav-container {
            max-width: 28rem;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            align-items: end;
            position: relative;
            height: 60px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 4px;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            transform: translateY(-1px);
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 11px;
            font-weight: 500;
        }

        .nav-item.active i {
            color: #3B82F6;
        }

        .nav-item.active span {
            color: #3B82F6;
        }

        .nav-center {
            grid-column: 3;
            display: flex;
            justify-content: center;
            align-items: end;
            height: 100%;
            position: relative;
        }

        .category-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .category-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-right: 16px;
        }

        .category-icon.terms {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
        }

        .category-icon.quiz {
            background: linear-gradient(135deg, #10B981, #059669);
        }

        .category-icon.news {
            background: linear-gradient(135deg, #F59E0B, #D97706);
        }

        .category-content {
            flex: 1;
        }

        .category-title {
            font-size: 18px;
            font-weight: bold;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .category-desc {
            font-size: 14px;
            color: #6B7280;
        }

        .category-arrow {
            color: #9CA3AF;
            font-size: 20px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<div class="min-h-screen bg-gray-100">
    <!-- 상단 헤더 -->
    <div class="bg-white shadow-sm p-4">
        <div class="flex items-center justify-between max-w-md mx-auto">
            <button onclick="location.href='index.html'" class="text-gray-600">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <div class="text-center">
                <h1 class="text-xl font-bold">금융 학습</h1>
                <p class="text-xs text-gray-500" id="lastUpdate">업데이트 확인 중...</p>
            </div>
            <button onclick="forceUpdate()" class="text-gray-600">
                <i class="fas fa-sync-alt text-xl" id="refreshIcon"></i>
            </button>
        </div>
    </div>

    <!-- 카테고리 선택 -->
    <div class="max-w-md mx-auto px-4 py-6 mb-24">
        <!-- 금융 용어 -->
        <div class="category-card" onclick="navigateToTerms()">
            <div class="category-icon terms">
                <i class="fas fa-book"></i>
            </div>
            <div class="category-content">
                <div class="category-title">금융 용어</div>
                <div class="category-desc" id="termsDesc">오늘의 금융 용어를 확인하세요</div>
            </div>
            <div class="category-arrow">
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>

        <!-- 금융 퀴즈 -->
        <div class="category-card" onclick="navigateToQuiz()">
            <div class="category-icon quiz">
                <i class="fas fa-gamepad"></i>
            </div>
            <div class="category-content">
                <div class="category-title">금융 퀴즈</div>
                <div class="category-desc" id="quizDesc">오늘의 뉴스 기반 퀴즈</div>
            </div>
            <div class="category-arrow">
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>

        <!-- 금융 뉴스 -->
        <div class="category-card" onclick="navigateToNews()">
            <div class="category-icon news">
                <i class="fas fa-newspaper"></i>
            </div>
            <div class="category-content">
                <div class="category-title">금융 뉴스</div>
                <div class="category-desc" id="newsDesc">실시간 경제 뉴스</div>
            </div>
            <div class="category-arrow">
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>
    </div>

    <!-- 하단 네비게이션 -->
    <div class="bottom-navigation">
        <div class="nav-container">
            <button onclick="location.href='index.html'" class="nav-item">
                <i class="fas fa-home text-gray-400"></i>
                <span class="text-gray-400">홈</span>
            </button>
            <button onclick="location.href='a2.html'" class="nav-item active">
                <i class="fas fa-newspaper"></i>
                <span>뉴스</span>
            </button>
            <div class="nav-center">
                <div class="level-badge-nav level-yellow" onclick="location.href='a5.html'">
                    YELLOW
                </div>
            </div>
            <button onclick="location.href='a4.html'" class="nav-item">
                <i class="fas fa-gamepad text-gray-400"></i>
                <span class="text-gray-400">게임</span>
            </button>
            <button onclick="location.href='a3.html'" class="nav-item">
                <i class="fas fa-ellipsis-h text-gray-400"></i>
                <span class="text-gray-400">더보기</span>
            </button>
        </div>
    </div>
</div>

<!-- 로딩 오버레이 -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="text-center">
        <div class="loading-spinner mb-4"></div>
        <p class="text-gray-600">오늘의 콘텐츠를 생성하는 중...</p>
    </div>
</div>

<script>
// API 설정 - 실제 사용 가능한 무료 API
const API_CONFIG = {
    newsapi: {
        key: '3d9b9c8a8dmsh123456789abcdef', // RapidAPI 키로 교체 필요
        baseUrl: 'https://newsapi.org/v2/top-headlines',
        proxy: 'https://api.allorigins.win/get?url='
    },
    finnhub: {
        key: 'YOUR_FINNHUB_API_KEY', // Finnhub API 키 필요
        baseUrl: 'https://finnhub.io/api/v1'
    }
};

// 오늘 날짜 가져오기
function getTodayDate() {
    return new Date().toLocaleDateString('ko-KR');
}

// 오늘의 데이터 확인 및 생성
async function checkAndGenerateTodayData() {
    const today = getTodayDate();
    const savedDate = localStorage.getItem('dataGeneratedDate');
    
    // 이미 오늘 데이터가 생성되어 있는지 확인
    if (savedDate === today) {
        const savedData = localStorage.getItem('todayFinancialData');
        if (savedData) {
            updateUI(JSON.parse(savedData));
            return JSON.parse(savedData);
        }
    }
    
    // 오늘 데이터가 없으면 생성
    document.getElementById('loadingOverlay').classList.add('show');
    
    try {
        const todayData = await generateTodayData();
        
        // 데이터 저장
        localStorage.setItem('dataGeneratedDate', today);
        localStorage.setItem('todayFinancialData', JSON.stringify(todayData));
        
        updateUI(todayData);
        
        document.getElementById('loadingOverlay').classList.remove('show');
        
        return todayData;
        
    } catch (error) {
        console.error('데이터 생성 오류:', error);
        document.getElementById('loadingOverlay').classList.remove('show');
        
        // 오류 시 백업 데이터 사용
        const backupData = generateBackupData();
        localStorage.setItem('dataGeneratedDate', today);
        localStorage.setItem('todayFinancialData', JSON.stringify(backupData));
        updateUI(backupData);
        
        return backupData;
    }
}

// 오늘의 데이터 생성
async function generateTodayData() {
    // 실제 뉴스 가져오기 시도
    let newsData = [];
    
    try {
        // NewsAPI 대체 - 무료로 사용 가능한 RSS 피드 파싱
        const rssUrl = 'https://news.google.com/rss/search?q=경제+금융+주식&hl=ko&gl=KR&ceid=KR:ko';
        const response = await fetch(API_CONFIG.newsapi.proxy + encodeURIComponent(rssUrl));
        const data = await response.json();
        
        if (data.contents) {
            // RSS 파싱 (간단한 예시)
            const parser = new DOMParser();
            const xml = parser.parseFromString(data.contents, 'text/xml');
            const items = xml.querySelectorAll('item');
            
            items.forEach((item, index) => {
                if (index < 10) { // 최대 10개 뉴스
                    const title = item.querySelector('title')?.textContent || '';
                    const description = item.querySelector('description')?.textContent || '';
                    const pubDate = item.querySelector('pubDate')?.textContent || '';
                    
                    newsData.push({
                        id: 'news_' + Date.now() + '_' + index,
                        title: title,
                        description: description.replace(/<[^>]*>/g, ''), // HTML 태그 제거
                        date: pubDate,
                        source: '구글 뉴스'
                    });
                }
            });
        }
    } catch (error) {
        console.log('뉴스 API 오류, 백업 데이터 사용');
    }
    
    // 뉴스가 없으면 백업 데이터 사용
    if (newsData.length === 0) {
        newsData = generateBackupNewsData();
    }
    
    // 뉴스 기반으로 용어와 퀴즈 생성
    const terms = generateTermsFromNews(newsData);
    const quizzes = generateQuizzesFromNews(newsData);
    
    return {
        news: newsData,
        terms: terms,
        quizzes: quizzes,
        generatedAt: new Date().toISOString()
    };
}

// 뉴스에서 금융 용어 추출 및 생성
function generateTermsFromNews(newsData) {
    // 금융 키워드 사전
    const financialKeywords = {
        '금리': { 
            term: '금리(Interest Rate)', 
            definition: '자금을 빌려주거나 빌릴 때 적용되는 이자의 비율',
            example: '한국은행이 기준금리를 연 3.5%로 결정했습니다.'
        },
        '코스피': { 
            term: '코스피(KOSPI)', 
            definition: '한국종합주가지수로, 한국거래소 유가증권시장에 상장된 모든 종목의 시가총액을 지수화한 것',
            example: '오늘 코스피는 2,650선에서 마감했습니다.'
        },
        '인플레이션': { 
            term: '인플레이션(Inflation)', 
            definition: '물가가 지속적으로 상승하는 현상',
            example: '인플레이션율이 2%를 넘어서면서 중앙은행이 긴축정책을 고려하고 있습니다.'
        },
        'ETF': { 
            term: 'ETF(Exchange Traded Fund)', 
            definition: '거래소에서 주식처럼 거래되는 인덱스펀드',
            example: 'KODEX 200 ETF는 코스피 200 지수를 추종합니다.'
        },
        'PER': { 
            term: 'PER(주가수익비율)', 
            definition: '주가를 주당순이익으로 나눈 값으로, 주가의 수익성을 평가하는 지표',
            example: '삼성전자의 PER은 15배로 업계 평균보다 낮습니다.'
        },
        '배당': { 
            term: '배당(Dividend)', 
            definition: '기업이 영업활동으로 얻은 이익을 주주들에게 나누어 주는 것',
            example: '이 회사는 주당 1,000원의 배당금을 지급했습니다.'
        },
        '시가총액': { 
            term: '시가총액(Market Capitalization)', 
            definition: '상장된 주식의 총 가치로, 주가에 발행주식수를 곱한 값',
            example: '삼성전자의 시가총액이 400조원을 돌파했습니다.'
        },
        '변동성': { 
            term: '변동성(Volatility)', 
            definition: '자산 가격의 변동 정도를 나타내는 지표',
            example: '최근 주식시장의 변동성이 커지면서 투자자들이 주의를 기울이고 있습니다.'
        }
    };
    
    const terms = [];
    const usedTerms = new Set();
    
    // 뉴스에서 키워드 찾기
    newsData.forEach(news => {
        const content = (news.title + ' ' + news.description).toLowerCase();
        
        Object.keys(financialKeywords).forEach(keyword => {
            if (content.includes(keyword.toLowerCase()) && !usedTerms.has(keyword)) {
                terms.push({
                    ...financialKeywords[keyword],
                    relatedNews: news.title,
                    id: 'term_' + Date.now() + '_' + terms.length
                });
                usedTerms.add(keyword);
            }
        });
    });
    
    // 최소 3개 용어 보장
    if (terms.length < 3) {
        const allKeywords = Object.keys(financialKeywords);
        while (terms.length < 3) {
            const randomKey = allKeywords[Math.floor(Math.random() * allKeywords.length)];
            if (!usedTerms.has(randomKey)) {
                terms.push({
                    ...financialKeywords[randomKey],
                    relatedNews: '오늘의 경제 뉴스',
                    id: 'term_' + Date.now() + '_' + terms.length
                });
                usedTerms.add(randomKey);
            }
        }
    }
    
    // 오늘의 주요 용어 선택 (첫 번째 용어)
    if (terms.length > 0) {
        terms[0].isToday = true;
    }
    
    return terms;
}

// 뉴스 기반 퀴즈 생성
function generateQuizzesFromNews(newsData) {
    const quizTemplates = [
        {
            type: 'news_fact',
            generate: (news) => ({
                question: `최근 뉴스: "${news.title.substring(0, 50)}..." 이 뉴스와 가장 관련 있는 금융 분야는?`,
                options: ['주식시장', '채권시장', '외환시장', '원자재시장'],
                correct: Math.floor(Math.random() * 4),
                difficulty: 'beginner'
            })
        },
        {
            type: 'term_definition',
            generate: () => ({
                question: '다음 중 P/E Ratio(주가수익비율)에 대한 설명으로 옳은 것은?',
                options: [
                    '주가를 주당순이익으로 나눈 값',
                    '자산총액을 부채총액으로 나눈 값',
                    '매출액을 영업이익으로 나눈 값',
                    '시가총액을 매출액으로 나눈 값'
                ],
                correct: 0,
                difficulty: 'intermediate'
            })
        },
        {
            type: 'market_analysis',
            generate: () => ({
                question: '금리가 인상되면 일반적으로 주식시장에 미치는 영향은?',
                options: [
                    '주가 상승 압력',
                    '주가 하락 압력',
                    '영향 없음',
                    '단기 상승, 장기 하락'
                ],
                correct: 1,
                difficulty: 'advanced'
            })
        }
    ];
    
    const quizzes = {
        beginner: [],
        intermediate: [],
        advanced: []
    };
    
    // 각 난이도별로 5개씩 퀴즈 생성
    ['beginner', 'intermediate', 'advanced'].forEach(difficulty => {
        for (let i = 0; i < 5; i++) {
            const template = quizTemplates[Math.floor(Math.random() * quizTemplates.length)];
            const news = newsData[Math.floor(Math.random() * Math.min(newsData.length, 5))];
            
            const quiz = template.generate(news || {title: '경제 뉴스'});
            quiz.id = `quiz_${difficulty}_${Date.now()}_${i}`;
            quiz.difficulty = difficulty;
            
            quizzes[difficulty].push(quiz);
        }
    });
    
    return quizzes;
}

// 백업 뉴스 데이터
function generateBackupNewsData() {
    const today = new Date();
    return [
        {
            id: 'backup_news_1',
            title: '한국은행, 기준금리 동결 결정... 경제 불확실성 고려',
            description: '한국은행 금융통화위원회가 기준금리를 현 수준에서 동결하기로 결정했습니다. 글로벌 경제 불확실성과 국내 물가 안정세를 종합적으로 고려한 결과입니다.',
            date: today.toISOString(),
            source: '경제뉴스'
        },
        {
            id: 'backup_news_2',
            title: '코스피 2,650선 회복... 외국인 순매수 지속',
            description: '코스피가 외국인 투자자들의 순매수에 힘입어 2,650선을 회복했습니다. 반도체와 2차전지 관련주가 강세를 보였습니다.',
            date: today.toISOString(),
            source: '증권뉴스'
        },
        {
            id: 'backup_news_3',
            title: '삼성전자, AI 반도체 신제품 발표... 주가 3% 상승',
            description: '삼성전자가 차세대 AI 반도체를 발표하며 주가가 급등했습니다. 새로운 칩은 성능이 2배 향상되고 전력 소비는 30% 감소했습니다.',
            date: today.toISOString(),
            source: '기업뉴스'
        },
        {
            id: 'backup_news_4',
            title: '미 연준, 금리 인하 가능성 시사... 글로벌 증시 상승',
            description: '미국 연방준비제도가 경제 지표 개선에 따라 금리 인하 가능성을 시사했습니다. 이에 글로벌 증시가 일제히 상승했습니다.',
            date: today.toISOString(),
            source: '국제뉴스'
        },
        {
            id: 'backup_news_5',
            title: '국내 ETF 시장 규모 100조원 돌파... 개인투자자 증가',
            description: '국내 ETF 시장 규모가 처음으로 100조원을 돌파했습니다. 개인투자자들의 ETF 투자가 크게 늘어난 것이 주요 원인입니다.',
            date: today.toISOString(),
            source: '투자뉴스'
        }
    ];
}

// 백업 데이터 생성
function generateBackupData() {
    const newsData = generateBackupNewsData();
    return {
        news: newsData,
        terms: generateTermsFromNews(newsData),
        quizzes: generateQuizzesFromNews(newsData),
        generatedAt: new Date().toISOString()
    };
}

// UI 업데이트
function updateUI(data) {
    // 마지막 업데이트 시간 표시
    const updateTime = new Date(data.generatedAt);
    document.getElementById('lastUpdate').textContent = 
        `${updateTime.toLocaleDateString('ko-KR')} ${updateTime.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})} 업데이트`;
    
    // 카테고리 설명 업데이트
    const todayTerm = data.terms.find(t => t.isToday);
    if (todayTerm) {
        document.getElementById('termsDesc').textContent = 
            `오늘의 용어: ${todayTerm.term.split('(')[0]}`;
    }
    
    document.getElementById('quizDesc').textContent = 
        `${data.quizzes.beginner.length + data.quizzes.intermediate.length + data.quizzes.advanced.length}개의 새로운 퀴즈`;
    
    document.getElementById('newsDesc').textContent = 
        `${data.news.length}개의 최신 뉴스`;
}

// 페이지 이동 함수들
function navigateToTerms() {
    location.href = 'a2-terms.html';
}

function navigateToQuiz() {
    location.href = 'a2-quiz.html';
}

function navigateToNews() {
    location.href = 'a2-news.html';
}

// 강제 업데이트
async function forceUpdate() {
    const refreshIcon = document.getElementById('refreshIcon');
    refreshIcon.style.transform = 'rotate(360deg)';
    refreshIcon.style.transition = 'transform 0.5s ease';
    
    // 기존 데이터 삭제
    localStorage.removeItem('dataGeneratedDate');
    localStorage.removeItem('todayFinancialData');
    
    // 새로 생성
    await checkAndGenerateTodayData();
    
    setTimeout(() => {
        refreshIcon.style.transform = 'rotate(0deg)';
    }, 500);
    
    alert('오늘의 콘텐츠가 업데이트되었습니다!');
}

// 페이지 로드시 실행
document.addEventListener('DOMContentLoaded', async function() {
    console.log('금융 학습 페이지 로드 - ' + new Date().toLocaleString('ko-KR'));
    await checkAndGenerateTodayData();
});
</script>

</body>
</html>
